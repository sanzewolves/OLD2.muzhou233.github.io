---
layout: post
title: 感受漂移快感
subtitle: 双路x58上手体验
date: 2019-07-13
lastDate: 2019-12-14
categories: blog
tags: []
description:
editing: true
---

|灵车到手||
|---|---|
|Mother board|X8DTL|
|CPU|e5645 x 2|
|MEM|DDR3 ECC REG 1333 4GiB x 2|
|SSD|Wanyou 1 14.9GiB|
|Power|AcBel 24Pin+4Pin 86W MAX(240W TOTAL MAX)|

买前双四核，买后双六核。  
买前1066，买后1333。  
买风扇买二赠二，80W供电4Pin双U。  

---

# 阶段性总结 v1

|灵车现状||
|---|---|
|Mother board|X8DTL|
|CPU|x5650 x 2|
|GPU|GTX650 + GT630|
|MEM|DDR3 ECC REG 1333 4GiB x 6|
|SSD|Wanyou 14.9GiB x 1|
|HDD|WDC 500GiB x 2 + Seagate 500GiB x 2|
|Power|(500W TOTAL MAX)|

*这玩意的配置就没有正常过*  

经过长时间的折腾，在 @Certe @Tabing 的帮助下我的 X58 玩具总算有点正常了。  
说实话我因为贫穷~~和懒~~总是被认为掌握着一些我并不会的技能，这次是为了能在计算机硬件上多了解一点~~并且省点钱~~入了一块 X58 的双路主板尝试学习，结果很多时间都是在看别人帮我。学还是学到了不少的。  

## 出现的问题

1. 板载显卡在 Win 平台只有 2008 的驱动
2. GT630 在 Win10 平台只有 LTSC 版本能正常驱动
3. GTX650 + GT630 在 Linux 平台无法正常双卡输出
4. GTX650 在 Linux 平台无法正常双屏输出
5. SSD 容量太小
6. HDD 速度太低
7. 散热不足

## 解决方案

### 使用 Win10LTSC 作为 Host

1. 在 BIOS 中选择独立显卡为主显卡
2. 在 BIOS 中启用 Intel Fake RAID 选项并配置四块 HDD 为 RAID 1+0
3. 将 Windows 安装在 RAID 上，安装之后将 SSD 分为一个区并启用 ReadyBoost

**结果：**整个过程十分无脑，并且没有遇到什么问题，显示器也插哪都显示，只是时不时会蓝屏重启（传统艺能）。然而最大的问题就是硬盘IO，不管是 Fake RAID 还是 ReadyBoost 都十分丢人，该提升的顺序读写没提升，该降低的随机读写倒是降低了，该缓存的也没感觉有缓存还成天提示磁盘空间不足（你自己的功能把磁盘占满了你还不知道？）（传统艺能）

### 使用 ArchLinux 作为 Host

1. 拔掉 GT630
2. 在 BIOS 中选择独立显卡为主显卡
3. 在 BIOS 中关闭 RAID
4. 进入 ArchLinux LiveCD
    1. 使用 mdadm 把四块 HDD 设置为软 RAID10(far2)
    2. 使用 lvm 在 RAID 磁盘上建立一个分区
    3. 将 SSD 分为两个区，第一个区作为 /boot，使用 lvm 将第二个区加入 RAID 所在的卷组
    4. 使用 lvm 将卷组中的 SSD 分区设置为 RAID 的读缓存，经过缓存的磁盘作为 /
    5. 挂载 / /boot 并安装系统
    6. arch-chroot 环境中启用 mdadm 和 lvm 的组件并写入配置文件
    7. 重启
5. 没有翻车

**结果：**安装前后的配置很麻烦，最初因为没有在安装后写入配置导致各种奇怪 bug 以至于让人怀疑方案的可行性。安装 KDE 之后第二屏幕不管怎么搞都不输出，为了检查是不是硬件问题写了一个 Windows 的安装镜像启动进去发现能显示，再重启回到 ArchLinux 第二屏幕就亮了。使用一段时间之后读缓存的效果很明显，还发现了 Steam 已经开放了全游戏的 Proton 支持（基于 Wine）

## 结尾

由于贫穷和没有运算需求散热问题仍然没有解决  
整个配置过程不断在

|去你的Winbug|ArchLinux真麻烦|
|---|---|
|Windows真香|Archlinux真香|

四个状态之间反复横跳

# 阶段性总结 v2

|一些变化||
|---|---|
|GPU|GTX650|
|MEM|DDR3 ECC REG 1333 4GiB x 4|

*没错，配置缩水了*

之前一直在使用无铜管下压侧吹散热器，散热能力仅仅能支持主机开机，小尺寸高转速的风扇不仅散热能力差而且噪音还大，满载 60 秒即可到达 95°C 触发主板过热保护。于是我花费了50CNY的重金购买了两个二手双热管塔式散热器，散热好了，声音小了，两条内存也因为内存槽靠 CPU 太近插不上了。

## 回归本质

经过一段时间的使用，我发现果然服务器机就应该有一个服务器的样子，用来做日用机太鸡肋了，于是开始寻找下一套解决方案。  
考虑到硬件的现状，**虚拟化**和**RAID**是必须要有的，于是我花了几天对比尝试了各种我能找到的方案：

### Windows

不可能的，这台机扭曲的配置用 Windows 没有足够的操作空间

### DIY

给 kvm 套一个 WebUI 的皮，再加上一些其他的辅助工具。  
自己拼凑出来的很难有比较干净的管理体系，而且基本上也只是给虚拟机方面的命令行操作套了一层皮。  

### ESXi

安装使用都很简单，网上也可以找到永久激活码。  
VMware 官方：软 RIAD 和 Fake RAID 都不受支持，请使用 RAID 卡。  

### OpenStack

开源的云计算管理平台，有丰富的组件和统一的接口。  
更加关注集群管理方面的任务，作为单节点集群安装有很多功能用不到，在单机管理方面也有许多需要自行解决的问题。  

### Unraid

non-free

### ProXmoX

这个就是我的最终选择了。  
基于 Debian 有公司维护的免费+订阅制系统，用于小规模集群，在单机管理上的功能也很丰富。  

1. 为机器准备好一个固定的 ip 地址
1. 从U盘启动安装镜像
1. 安装系统到固态硬盘
1. 重启到系统使用其他设备登录 WebUI
1. 更换软件源为 ustc 源
1. 将四块机械硬盘组建为 ZFS-Z1
1. 用就是了

目前没有遇到什么大问题，使用时大部分操作都可以靠 WebUI 解决，解决不了的就进 Shell。支持 kvm 虚拟机和 lxc 容器，在 pci 直通上也做了很多预置参数（但是 error 43 是不会屈服的）。
