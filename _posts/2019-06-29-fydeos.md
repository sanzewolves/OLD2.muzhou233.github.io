---
layout: post
title: FydeOS推荐及个人使用记录
date: 2019-06-29
lastDate: 2019-06-29
categories: blog
tags: [LINUX,FYDEOS,CHROMEOS]
description:
timedepend: true
editing: true
---

本文旨在记录我的使用方法以及帮助更多的人学会使用FydeOS，ChromeOS可以用作参考。  
**注意，本人建议在没有独显的二合一设备上使用ChromeOS系列的操作系统，比如Microsoft Surface、Lenovo MIIX。**  
**本文仅限于按照无独显的64位英特尔酷睿CPU设备进行描述，其他类型的硬件仅作参考**  

## 为什么要用ChromeOS

以Surface为例，作为一个二合一PC，Surface的标准配件就是Surface Typecover和Surface Pen。虽然我认为用鼠标实在是多此一举，但在Windows 10环境下，Surface确实是一个不讨好的设备。因为Windwos x86应用对触屏优化太差 Windows UWP应用生态又差，所以Surface的体验会很差，但纵观目前主流的操作系统：Windows、Linux、MacOS、Android、IOS、IpadOS，前三者拥有更丰富更强大的功能，后三者拥有良好的移动设备优化。如果我们想同时满足两个要求，入手点就在于Linux和Android。特别是对于开发人员来说，Linux是不可割舍的，而Andoid又是基于Linux虚拟机开发的，并且两者都有开放源代码，在理论上一定有办法实现基于完整Linux系统的安卓。第一个把这件事做大的，是安卓亲爹Google，这个融合出的系统就是ChromeOS。虽然一直宣称是云操作系统，但仍然是有办法本地化的。  
Google只对ChromeBook系列的机器推出ChromeOS适配，而其他机器想要使用ChromeOS就需要选择基于ChromeOS的开源项目二次开发的类ChromeOS系统，FydeOS是其中之一。在内容相同的情况下，我会优先将FydeOS称为ChromeOS。

## 在使用前先了解系统结构

目前阶段想要用好ChromeOS仍然需要有一定的Linux基础

- Linux 底层
    - Chrome 浏览器
        - Chrome 插件
        - Chrome APP
    - ARC++ 安卓运行时环境
        - Android APP
    - crosvm 虚拟机
        - Termina 虚拟机映像
            - Linux 容器

### 本体

ChromeOS本身的Linux系统是一个高度阉割版的Linux，很多Linux必备的功能都没有，并且ChromeOS会将一块硬盘分为多个分区存储不同路径下的内容，而Linux系统关键目录都会自动挂载为只读并且所在分区不会有太多剩余空间。这种特性使得修改系统变得十分困难。  
这也是我选择FydeOS的一个原因，FydeOS可以将原本的多分区安装方法变为单分区安装，除启动引导文件外其他文件都会存储于一个.img映像中，大小正好占满整个分区。

### Chrome 浏览器

Chrome浏览器是ChromeOS的核心，整个系统界面的显示都是由Chrome负责的，在使用上与普通的Chrome浏览器并无不同，能够安装插件和网页应用，唯一的不同就是使用组合键Ctrl+Alt+T能够打开crosh，而crosh提供了系统本身的Linux终端入口。

### Android 子系统

这是Google专门为ChromeOS定制的安卓系统，比虚拟机效率高很多还和ChromeOS本身高度融合，主要体现为：
1. 安卓设置APP里只显示Chrome设置页面中没有的项目，两个系统都有的设置项目是共用的，显示在Chrome设置页面中。
2. 安卓中安装AIDA64等软件之后看到的系统硬件信息是完整的真实信息
3. 安卓软件的显示方式与安卓x86相同
4. 安卓使用Chrome作为webviewer（注意此处并不是指安卓版的Chrome），网页也可以正常调用APP打开链接
可以说安卓子系统的存在极大的满足了日用的很多需求

### Linux 子系统
  
ChromeOS本身是一个Linux却又使用了一个Linux容器，其初衷是为了满足用户对Linux功能的需求又能保证本身的系统结构不被破坏，运行速度不会因为使用时间延长而变慢。Linux容器默认使用Ubuntu，也可以自行修改发行版，容器通过[Crostini](https://www.reddit.com/r/Crostini)与ChromeOS高度融合。

## 下载安装以及初始化设置

由于目前FydeOS仍处于开发阶段，安装配置过程小白不友好，此处也不再赘述，可以参考我的[内测版体验报告](/blog/2019/06/28/fydeos)。  

## 如何满足日常需求

首先对于Chrome浏览器和Android子系统来说，首要要解决的问题就是访问外网，因为无论是Chrome插件还是Android APP，在无法访问外网的情况下下载和及时更新都得不到保证，本文仅仅提出这个问题，并不会提供解决方法。  

### Chrome 浏览器

Chrome浏览器我推荐仍然当作一个普通浏览器使用，Chrome APP跟Android APP比起来体验差很多。  
FydeOS关闭了Google帐号功能，如果想要自行开启请参考[XDA的文章](https://forum.xda-developers.com/hardware-hacking/chromebooks/fydeos-google-sync-using-fydeos-account-t3872442)。这个文章的方法随着FydeOS更新可能会失效。  

### Android 子系统

如果你使用过Android x86的话使用起子系统应该是得心应手的，因为在使用体验上是完全一致的。  
如果你没有用过Android x86但是用过Chrome和Android，你可以通过对比来决定到底使用网页端还是Android APP。  
如果你这两个都没用过。  

### Linux 子系统

相信需要用到Linux子系统的就更加不用多说了，这里仅放一个[修改发行版的教程](https://www.reddit.com/r/Crostini/wiki/howto/run-arch-linux)

### Linux 本体

#### 初始化配置

这部分是本文的最重要的部分，由于FydeOS本身就安装在轻薄设备上，这类设备对续航时间十分敏感，Android子系统作为刚需是不可能关闭的，而如果我们合理使用Linux本体，关闭Linux子系统是完全可以实现的。并且通过自定义系统设置，我们也可以使续航时间进一步延长。  
**下文仅限于FydeOS单分区安装环境，其他环境可能不适用。**  
在Chrome浏览器任意页面按下组合键`Ctrl+Alt+T`进入crosh，再输入`shell`回车即可进入终端。第一步我们将系统挂载为可读写，这个操作并不是必须的但有时是需要的。  

    mount -o remount,rw /

这时如果你运行几个你在Linux上用到的命令就可以发现，它支持的命令实在是太少了！包管理器也理所应当的没有。  
所以我们的下一步就是先解决包管理器的问题，没有包管理器依赖问题就会成为我们永远的痛。这里你有两个选择：

1. 自己下载某个包管理器的二进制文件及其以来并手动放到正确的文件夹、手动配置。如果成功实现，你的ChromeOS将会拥有真正的包管理器，剩下的事情也会简单许多，但是难度很大。
2. 使用[ChromeBrew](https://github.com/skycocker/chromebrew)一键脚本。ChromeBrew是一个由人工维护的专门为ChromeOS提供的包管理器，它安装使用都很方便，但是缺点是软件包很少而且由人工维护没有保障。

我目前仍然在使用ChromeBrew，我同样建议先使用ChromeBrew，如果有精力可以再尝试其他的包管理器。或者你也可以为ChromeBrew贡献代码使它成为一个好用的包管理器。解决了包管理器的问题，很多常用的依赖库也都自动安装上了。  
下面介绍几个我遇到的ChromeBrew无法安装的软件。

#### TLP电源管理

如果你嫌你的电脑不够省电的话，可以安装一个TLP查看设备信息及修改电源设置，安装方法参考自[FydeOS社区的帖子](https://fydeos.com/community/topic/18627/)。

在开始之前请安装好git和命令行编辑器（这里以vi为例），并且以普通用户执行。

```shell
cd ~/Downloads
git clone https://github.com/linrunner/TLP.git
cd TLP
vim Makefile
```
```shell
#前几行的内容修改如下，修改后保存退出

# Makefile for TLP

# Evaluate parameters
TLP_SBIN   ?= /usr/local/sbin
TLP_BIN    ?= /usr/local/bin
TLP_TLIB   ?= /usr/local/share/tlp
TLP_FLIB   ?= /usr/local/share/tlp/func.d
TLP_ULIB   ?= /usr/local/lib/udev
TLP_NMDSP  ?= /usr/local/etc/NetworkManager/dispatcher.d
TLP_CONF   ?= /usr/local/etc/default/tlp
TLP_SYSD   ?= /usr/local/lib/systemd/system
TLP_SYSV   ?= /usr/local/etc/init.d
TLP_ELOD   ?= /usr/local/lib/elogind/system-sleep
TLP_SHCPL  ?= /usr/local/share/bash-completion/completions
TLP_MAN    ?= /usr/local/share/man
TLP_META   ?= /usr/local/share/metainfo
TLP_RUN    ?= /run/tlp
```
```shell
#下面两个指令会很快执行结束并输出内容，只要没有报错就是正常安装
sudo make
sudo make install
```
至此安装完成，配置文件位于`/usr/local/etc/defualt/tlp`，启动tlp的命令是`sudo tlp start`，更多的功能及配置请查看[官方文档](https://linrunner.de/en/tlp/docs/tlp-configuration.html)。

#### Visual Studio Code

VScode是我目前认为最好用也一直在使用的编辑器，在FydeOS上无论是使用Linux子系统还是ChromeBrew的实现都是将原版的VScode通过各种中间层投到屏幕上，有缩放问题、触摸响应问题、还费电。经过我的不断尝试寻找，发现了一个完美的解决方案：[code-server](https://github.com/cdr/code-server)。  
众所周知VScode是基于Electron开发的，那么理论上浏览器也应该能打开VScode页面（官方已经准备推出网页版了），而实现了这个想法的就是code-server。它将VScode前后端分离，后端运行于服务器上，前端由任意浏览器打开，实现了远程使用VScode修改文件。我们只需要在ChromeOS运行这个服务器再用Chrome打开前端就可以使用原生渲染的VScode修改本地文件了（本文就是在这种情况下写成的）。  
code-server提供了预编译的二进制文件，更是方便了我们的使用。首先使用浏览器从GitHub下载最新的Linux-x64二进制文件，再打开shell终端：

```shell
cd ~/Downloads
tar -zxvf code-server********-linux-x64.tar.gz
cd code-server******-linux-x64
sudo mv code-server /bin
#在我的电脑上不放入bin文件夹无法执行，表现为 Permission denied
```

至此安装就结束了，使用方式可以查看官方文档，最便捷的打开方式就是在终端输入

    code-server --no-auth

然后打开 http://localhost:8443